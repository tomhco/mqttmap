<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Map Pollution</title>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://piedpiper.tomhco.rocks:3000/socket.io/socket.io.js"></script>
    <style type="text/css">

      #map-canvas {

        position: absolute;
        top: 0;
        left: 0;
        right: 20%;
        bottom: 0;

      }

      #sidebar {

        position: absolute;
        top: 0;
        left: 80%;
        right: 0;
        bottom: 0;
        background-color: '#ffffff';

      }

    </style>
  </head>
  <body>
    <div id="map-canvas"></div>
    <div id="sidebar"></div>
    <script type="text/javascript">

      var socket = io.connect('http://piedpiper.tomhco.rocks:3000');

      var routes = [

        [{
          location: new google.maps.LatLng(50.386823, -4.182615),
          stopover:true
        }], [{
          location: new google.maps.LatLng(50.36917, -4.134722),
          stopover:true
        }], [{
          location: new google.maps.LatLng(50.377653, -4.161243),
          stopover:true
        }]

      ];

      google.maps.event.addDomListener(window, 'load', function () {

        var mapOptions = {

          zoom: 14,
          center: new google.maps.LatLng(50.377946, -4.171320),
          mapTypeControl: false,
          streetViewControl: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP

        };

        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        var directionsService = new google.maps.DirectionsService();

        var loop = function (i) {

          var request = {
            origin: new google.maps.LatLng(50.374744, -4.193722),
            destination: new google.maps.LatLng(50.375784, -4.139477),
            waypoints: routes[i],
            optimizeWaypoints: true,
            travelMode: google.maps.TravelMode.DRIVING
          };

          return directionsService.route(request, function(response, status) {

            if (status == google.maps.DirectionsStatus.OK) {

              var directionsDisplay = new google.maps.DirectionsRenderer();

              directionsDisplay.setMap(map);

              directionsDisplay.setOptions({

                preserveViewport: true,
                suppressInfoWindows: true,

                  polylineOptions: {
                    strokeWeight: 4,
                    strokeOpacity: 0.8,
                    strokeColor: 'green'
                }

              });

              directionsDisplay.setDirections(response);

              socket.on('route' + i, function(color) {

                directionsDisplay.setOptions({

                  polylineOptions: {
                    strokeColor: color
                  }

                });

                directionsDisplay.setDirections(response);

              });

              socket.emit('route' + i);

              if(i+1 < routes.length) {

                i++;
                loop(i);

              }

            }

          });

        };

        loop(0);

      });

    </script>
  </body>
</html>
